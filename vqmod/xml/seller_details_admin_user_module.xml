<modification>
    <id>Seller Details Show in Admin USER Module</id>
    <version>2.0.0</version>
    <vqmver>2.3.0</vqmver>
    <update>0.0.1</update>
    <author>Rohit Batra</author>

    <file name="admin/controller/user/user.php">

        <operation>
            <search position="replace"><![CDATA[
                $user_info = $this->model_user_user->getUser($this->request->get['user_id']);
            ]]></search>
            <add><![CDATA[
			    $user_info = $this->model_user_user->getUser($this->request->get['user_id']);
			    $data['details'] = $this->model_user_user->getSellerDetails($this->request->get['user_id']);
			    $data['transactions'] = $this->model_user_user->getSellerTransactionDetails($this->request->get['user_id']);
            ]]></add>
        </operation>

        <operation>
            <search position="before"><![CDATA[
                $this->load->model('user/user_group');
            ]]></search>
            <add><![CDATA[
                $data['user_is_seller'] = false;
			    if($data['user_group_id'] !== '1' || $data['user_group_id'] !== '2')
			    {
			        $data['user_is_seller'] = true;
                }
            ]]></add>
        </operation>

    </file>

    <file name="admin/model/user/user.php">

        <operation>
            <search position="before"><![CDATA[
                public function getUser($user_id) {
            ]]></search>
            <add><![CDATA[

			    public function getSellerDetails($user_id) {
			        $retArr = array();

                    $query = $this->db->query("SELECT key, value FROM `" . DB_PREFIX . "seller_info` sd WHERE sd.user_id = '" . (int)$user_id . "'");

                    foreach ($query->rows as $row) {
                        $retArr[$row['key']] = $row['value'];
                    }
                    return $retArr;
                }

			    public function getSellerTransactionDetails($user_id) {
                    $query = $this->db->query("SELECT * FROM `" . DB_PREFIX . "seller_payments` spu WHERE spu.user_id = '" . (int)$user_id . "'");

                    return $query->rows;
                }

                public function getSellerProducts($user_id) {
                    $query = $this->db->query("SELECT pd.name, dd.name as filename, d.mask as filemask, DATE(p.date_added) as date_added FROM `" . DB_PREFIX . "product` AS p LEFT OUTER JOIN `" . DB_PREFIX . "product_description` pd ON (p.product_id = pd.product_id) LEFT OUTER JOIN `" . DB_PREFIX . "product_to_download` ptd ON (ptd.product_id = p.product_id) LEFT OUTER JOIN `" . DB_PREFIX . "download` d ON (d.download_id = ptd.download_id) LEFT OUTER JOIN `" . DB_PREFIX . "download_description` dd ON (dd.download_id = d.download_id) WHERE p.seller_id = '". (int)$user_id ."' AND dd.language_id = '1' ");

                    return $query->rows;
                }

            ]]></add>
        </operation>

    </file>

    <!-- Seller Emails Changes -->
    <file name="admin/controller/common/forgotten.php">

      <operation>
          <search position="replace" offset="1"><![CDATA[
              $message .= $this->language->get('text_change') . "\n\n";
          ]]></search>
          <add><![CDATA[
              $message .= sprintf($this->language->get('text_change'), $this->url->link('common/reset', 'code=' . $code, true), ENT_QUOTES, 'UTF-8') . "\n\n";
          ]]></add>
      </operation>

      <operation>
          <search position="after"><![CDATA[
            $message .= sprintf($this->language->get('text_ip'), $this->request->server['REMOTE_ADDR']) . "\n\n";
          ]]></search>
          <add><![CDATA[
            $message .=  $this->language->get('text_mail_footer') . "\n\n";
          ]]></add>
      </operation>

      <operation>
          <search position="replace"><![CDATA[
            $mail->setText(html_entity_decode($message, ENT_QUOTES, 'UTF-8'));
          ]]></search>
          <add><![CDATA[
            $mail->setHtml($message);
          ]]></add>
      </operation>

    </file>

  <file name="admin/language/en-gb/mail/forgotten.php">
    <operation>
        <search position="replace"><![CDATA[
            $_['text_greeting'] = 'A new password was requested for %s administration.';
        ]]></search>
        <add><![CDATA[
            $_['text_greeting'] = 'A new password was requested for %s . <br/><br/>';
        ]]></add>
    </operation>

    <operation>
        <search position="replace"><![CDATA[
            $_['text_ip']       = 'The IP used to make this request was: %s';
        ]]></search>
        <add><![CDATA[
            $_['text_ip']       = 'The IP used to make this request was: %s <br/><br/>';
        ]]></add>
    </operation>

    <operation>
        <search position="replace"><![CDATA[
            $_['text_change']   = 'To reset your password click on the link below:';
        ]]></search>
        <add><![CDATA[
            $_['text_change']   = 'To reset your password click on the link below: <br/> <br/> <a href="%s">Click Here</a> <br/><br/>';
        ]]></add>
    </operation>

    <operation>
        <search position="after"><![CDATA[
            $_['text_subject']  = '%s - Password reset request';
        ]]></search>
        <add><![CDATA[
            $_['text_mail_footer']   = '<i>If you\'ve any problems using the above link, please email us at <a href="mailto:seller.support@sezplus.com">seller.support@sezplus.com</a></i> <br/>';
        ]]></add>
    </operation>

  </file>

</modification>
