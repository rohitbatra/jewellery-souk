<modification>
    <id>Product Module Changes - SOUK</id>
    <version>2.0.0</version>
    <vqmver>2.3.0</vqmver>
    <update>0.0.1</update>
    <author>Rohit Batra</author>

    <file name="admin/view/template/extension/soconfig/mproduct_form.tpl">

      <!-- Hide NEW options of Template -->
      <operation>
          <search position="replace" index="1,2,3,4"><![CDATA[
              <div class="form-group">
          ]]></search>
          <add><![CDATA[
              <div class="form-group hidden">
          ]]></add>
      </operation>

      <operation>
          <search position="replace" offset="3"><![CDATA[
              <li><a href="#tab-option" data-toggle="tab"><?php echo $tab_option; ?></a></li>
          ]]></search>
          <add><![CDATA[
          ]]></add>
      </operation>

      <operation>
          <search position="replace"><![CDATA[
              <li><a href="#tab-attribute" data-toggle="tab"><?php echo $tab_attribute; ?></a></li>
          ]]></search>
          <add><![CDATA[
          ]]></add>
      </operation>

      <operation>
          <search position="after"><![CDATA[
              <li><a href="#tab-image" data-toggle="tab"><?php echo $tab_image; ?></a></li>
          ]]></search>
          <add><![CDATA[
            <li><a href="#tab-attribute" data-toggle="tab"><?php echo $tab_attribute; ?></a></li>
          ]]></add>
      </operation>

      <operation>
          <search position="replace" offset="-1"><![CDATA[
              <label class="col-sm-2 control-label" for="input-image"><?php echo $entry_image; ?></label>
          ]]></search>
          <add><![CDATA[
            <div class="form-group required">
              <label class="col-sm-2 control-label" for="input-image"><?php echo $entry_thumbnail_image; ?></label>
          ]]></add>
      </operation>

      <operation>
          <search position="replace" offset="-1"><![CDATA[
              <label class="col-sm-2 control-label" for="input-location"><?php echo $entry_location; ?></label>
          ]]></search>
          <add><![CDATA[
            <div class="form-group required">
              <label class="col-sm-2 control-label" for="input-location"><?php echo $entry_location; ?></label>
          ]]></add>
      </operation>

      <operation>
          <search position="replace" offset="1"><![CDATA[
              <li><a href="#tab-reward" data-toggle="tab"><?php echo $tab_reward; ?></a></li>
          ]]></search>
          <add><![CDATA[
          ]]></add>
      </operation>

      <operation>
          <search position="replace" offset="-1"><![CDATA[
              <label class="col-sm-2 control-label"><?php echo $entry_store; ?></label>
          ]]></search>
          <add><![CDATA[
            <div class="form-group hidden">
              <label class="col-sm-2 control-label"><?php echo $entry_store; ?></label>
          ]]></add>
      </operation>

      <operation>
          <search position="before"><![CDATA[
              <?php echo $footer; ?>
          ]]></search>
          <add><![CDATA[
              <script type="text/javascript">
                $(window).load(function()
                {
                    // array of fields to not show
                    var fields = ['input-manufacturer','input-model','input-sku','input-upc','input-ean','input-jan','input-isbn','input-mpn','input-tax-class','input-subtract','input-stock-status','input-sort-order','input-meta-description1','input-meta-keyword1','input-tag1','input-download'];
                    $.each(fields, function (index, value) {
                        $('#'+value).parents('div.form-group').hide();
                    });

                    // No Id field & Default Model Value
                    $('input:radio[name="shipping"]').parents('div.form-group').hide();
                    $('input:radio[name="shipping"][value="0"]').prop('checked','checked');
                    $('#input-quantity').val("1000000");

                    $('#input-name1').on('change', function() {
                        $('#input-meta-title1').val($(this).val());
                    });

                    <?php if($is_seller == "true") { ?>
                      // Hide Filter Type from FORM - Auto-Select the type according to UG.
                      $('#chk-filter-<?php echo $default_user_type; ?>').attr("checked","checked");
                      $('#chk-filter-<?php echo $default_user_type; ?>').parents('div.form-group').hide();
                      // Hide Product Label
                      $('a[href="#tab-productlabel"]').hide();
                    <?php } ?>

                    // In EDIT functionality -- pre-populate filter checkboxes
                    var filter_og = '<?php echo $filters_str; ?>';
                    if(filter_og !== "")
                    {
                      var items = filter_og.split(',');
                      $.each(items, function (index, value) {
                          $('#chk-filter-'+value).attr("checked","checked");
                      });
                    }
                    <?php if(isset($_GET['product_id'])) { ?>
                      // Set Category in Select Drop Down for edit
                      $('#input-category').val(<?php echo $product_categories[0]['category_id']; ?>);
                    <?php } else { ?>
                      $('#input-model').val("<?php echo time(); ?>");
                    <?php } ?>

                });
              </script>
          ]]></add>
      </operation>

      <!-- Additional Fields for Product Module -->
      <operation>
          <search position="before"><![CDATA[
              <label class="col-sm-2 control-label" for="input-weight"><?php echo $entry_weight; ?></label>
          ]]></search>
          <add><![CDATA[
              <?php if(!$is_seller) { ?>
                <label class="col-sm-2 control-label" for="input-seller"><?php echo "Seller"; ?></label>
                <div class="col-sm-10">
                  <input type="text" value="<?php echo $seller; ?>" class="form-control" disabled="disabled" />
                </div>
               </div>
               <div class="form-group">
              <?php } ?>
          ]]></add>
      </operation>

      <!-- Making Category Compulsory -->

      <operation>
          <search position="replace" offset="-1"><![CDATA[
              <label class="col-sm-2 control-label" for="input-category"><span data-toggle="tooltip" title="<?php echo $help_category; ?>"><?php echo $entry_category; ?></span></label>
          ]]></search>
          <add><![CDATA[
            <div class="form-group">
              <label class="col-sm-2 control-label" for="input-brand"><?php echo $entry_manufacturer; ?></label>
              <div class="col-sm-10">
                <input type="text" name="brand" value="<?php echo $brand; ?>" placeholder="<?php echo $entry_manufacturer; ?>" id="input-brand" class="form-control" />
              </div>
            </div>
            <div class="form-group required">
              <label class="col-sm-2 control-label" for="input-category"><span data-toggle="tooltip" title="<?php echo $help_category; ?>"><?php echo $entry_category; ?></span></label>
          ]]></add>
      </operation>

      <operation>
          <search position="replace" offset="11"><![CDATA[
            <label class="col-sm-2 control-label" for="input-category"><span data-toggle="tooltip" title="<?php echo $help_category; ?>"><?php echo $entry_category; ?></span></label>
          ]]></search>
          <add trim="true"><![CDATA[
              <label class="col-sm-2 control-label" for="input-category"><?php echo $entry_category; ?></label>

              <?php if($is_seller) { ?>

                <div class="col-sm-10">
                  <select name="product_category[]" id="input-category" class="form-control">
                    <option value="*">Select Category</option>
                      <?php foreach($categories as $category) { ?>
                          <option value="<?php echo $category['category_id'];?>"><?php echo $category['name'];?></option>
                      <?php } ?>
                  </select>
                  <?php if ($error_product_category) { ?>
                    <div class="text-danger"><?php echo $error_product_category; ?></div>
                  <?php } ?>
                </div>

              <?php } else { ?>

                <div class="col-sm-10">
                  <input type="text" name="category" value="" placeholder="<?php echo $entry_category; ?>" id="input-category" class="form-control" />
                  <div id="product-category" class="well well-sm" style="height: 150px; overflow: auto;">
                    <?php foreach ($product_categories as $product_category) { ?>
                    <div id="product-category<?php echo $product_category['category_id']; ?>"><i class="fa fa-minus-circle"></i> <?php echo $product_category['name']; ?>
                      <input type="hidden" name="product_category[]" value="<?php echo $product_category['category_id']; ?>" />
                    </div>
                    <?php } ?>
                  </div>
                  <?php if ($error_product_category) { ?>
                    <div class="text-danger"><?php echo $error_product_category; ?></div>
                  <?php } ?>
                </div>
              <?php } ?>
          ]]></add>
      </operation>

      <!-- Making Category Compulsory ENDS-->

      <!-- Filter Easy UI for SELLERS -->
      <operation>
          <search position="replace" offset="-1"><![CDATA[
            <label class="col-sm-2 control-label" for="input-filter"><span data-toggle="tooltip" title="<?php echo $help_filter; ?>"><?php echo $entry_filter; ?></span></label>
          ]]></search>
          <add><![CDATA[
            <label class="col-sm-2 control-label" for="input-filter"><span data-toggle="tooltip" title="<?php echo $help_filter; ?>"><?php echo $entry_filter; ?></span></label>
            ]]></add>
      </operation>

      <operation>
          <search position="replace" offset="14"><![CDATA[
            <label class="col-sm-2 control-label" for="input-filter"><span data-toggle="tooltip" title="<?php echo $help_filter; ?>"><?php echo $entry_filter; ?></span></label>
          ]]></search>
          <add><![CDATA[
              <?php if($is_seller) { ?>
                <?php foreach ($all_product_filters as $filter_group) { ?>
                  <div class="form-group" id="filter-group-<?php echo $filter_group['fg_id']; ?>">
                      <label class="col-sm-2 control-label" for="input-filter"><?php echo $filter_group['name']; ?></label>
                      <div class="col-sm-10">
                        <?php foreach($filter_group['options'] as $filter_option) { ?>
                          <div class="checkbox col-sm-2">
                            <label>
                                <input type="checkbox" value="<?php echo $filter_option['filter_id']; ?>" id="chk-filter-<?php echo $filter_option['filter_id']; ?>" name="product_filter[]" /> &nbsp; <?php echo $filter_option['name'];?>
                            </label>
                          </div>
                        <?php } ?>
                      </div>
                  </div>
                <?php } ?>
              <?php } else { ?>
                <div class="form-group">
                  <label class="col-sm-2 control-label" for="input-filter"><?php echo $entry_filter; ?></label>
                  <div class="col-sm-10">
                    <input type="text" name="filter" value="" placeholder="<?php echo $entry_filter; ?>" id="input-filter" class="form-control" />
                    <div id="product-filter" class="well well-sm" style="height: 150px; overflow: auto;">
                      <?php foreach ($product_filters as $product_filter) { ?>
                      <div id="product-filter<?php echo $product_filter['filter_id']; ?>"><i class="fa fa-minus-circle"></i> <?php echo $product_filter['name']; ?>
                        <input type="hidden" name="product_filter[]" value="<?php echo $product_filter['filter_id']; ?>" />
                      </div>
                      <?php } ?>
                    </div>
                  </div>
                </div>
              <?php } ?>
          ]]></add>
      </operation>
      <!-- Filter Easy UI for SELLERS -->

      <!-- Restrict 5 Images per Product -->
      <operation>
          <search position="replace"><![CDATA[
            function addImage() {
          ]]></search>
          <add><![CDATA[
            function addImage() {
              if(image_row > '4') {
                alert("Sorry only 5 Images per Product are Allowed!");
              } else {
                html  = '<tr id="image-row' + image_row + '">';
                html += '  <td class="text-left"><a href="" id="thumb-image' + image_row + '"data-toggle="image" class="img-thumbnail"><img src="<?php echo $placeholder; ?>" alt="" title="" data-placeholder="<?php echo $placeholder; ?>" /><input type="hidden" name="product_image[' + image_row + '][image]" value="" id="input-image' + image_row + '" /></td>';
                html += '  <td class="text-right"><input type="text" name="product_image[' + image_row + '][sort_order]" value="" placeholder="<?php echo $entry_sort_order; ?>" class="form-control" /></td>';
                html += '  <td class="text-left"><button type="button" onclick="$(\'#image-row' + image_row  + '\').remove();" data-toggle="tooltip" title="<?php echo $button_remove; ?>" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
                html += '</tr>';

                $('#images tbody').append(html);

                image_row++;
              }
            }

            function addImageOLD() {
          ]]></add>
      </operation>

      <operation>
          <search position="after"><![CDATA[
            <input type="text" name="location" value="<?php echo $location; ?>" placeholder="<?php echo $entry_location; ?>" id="input-location" class="form-control" />
          ]]></search>
          <add><![CDATA[
            <?php if ($error_location) { ?>
              <div class="text-danger"><?php echo $error_location; ?></div>
            <?php } ?>
          ]]></add>
      </operation>

      <operation>
          <search position="after"><![CDATA[
            <input type="hidden" name="image" value="<?php echo $image; ?>" id="input-image" />
          ]]></search>
          <add><![CDATA[
            <?php if ($error_thumbnail_image) { ?>
              <div class="text-danger"><?php echo $error_thumbnail_image; ?></div>
            <?php } ?>
          ]]></add>
      </operation>

    </file>

    <file name="admin/language/en-gb/catalog/product.php">
      <!-- Making Category & Price Compulsory -->
        <operation>
            <search position="before"><![CDATA[
              $_['error_model']            = 'Product Model must be greater than 1 and less than 64 characters!';
            ]]></search>
            <add><![CDATA[
              $_['error_product_category']            = 'Please select one category for your Product!';
              $_['error_price']            = 'Please enter Price for your Product!';
              $_['error_location']            = 'Please enter Location of your Product!';
              $_['error_thumbnail_image']            = 'Please upload Thumbnail Image of your Product!';
            ]]></add>
        </operation>
        <!-- Making Category & Price Compulsory ENDS-->
    </file>

    <file name="admin/language/en-gb/soconfig/mproduct.php">
        <!-- Making Category & Price Compulsory -->
        <operation>
            <search position="before"><![CDATA[
              $_['error_model']            = 'Product Model must be greater than 1 and less than 64 characters!';
            ]]></search>
            <add><![CDATA[
               $_['error_product_category']            = 'Please select one category for your Product!';
               $_['error_price']            = 'Please enter Price for your Product!';
               $_['error_location']            = 'Please enter Location of your Product!';
               $_['error_thumbnail_image']            = 'Please upload Thumbnail Image of your Product!';
            ]]></add>
        </operation>

        <operation>
            <search position="before"><![CDATA[
                $_['entry_image']            = 'Image';
            ]]></search>
            <add><![CDATA[
               $_['entry_thumbnail_image']            = 'Thumbnail Image';
               $_['entry_seller']         = 'Seller';
            ]]></add>
        </operation>
        <!-- Making Category & Price Compulsory ENDS-->

        <operation>
            <search position="replace"><![CDATA[
                $_['entry_manufacturer']     = 'Manufacturer';
            ]]></search>
            <add><![CDATA[
               $_['entry_manufacturer']     = 'Brand';
            ]]></add>
        </operation>
    </file>

  <file name="admin/controller/catalog/mproduct.php">

    <operation>
        <search position="before"><![CDATA[
        $data['entry_sku'] = $this->language->get('entry_sku');
        ]]></search>
        <add><![CDATA[
        $data['error_product_category'] = $this->language->get('error_product_category');
        $data['error_price'] = $this->language->get('error_price');
        $data['error_location'] = $this->language->get('error_location');
        $data['error_thumbnail_image'] = $this->language->get('error_thumbnail_image');
        ]]></add>
    </operation>

    <operation>
        <search position="after"><![CDATA[
        $data['entry_image'] = $this->language->get('entry_image');
        ]]></search>
        <add><![CDATA[
        $data['entry_thumbnail_image'] = $this->language->get('entry_thumbnail_image');
        ]]></add>
    </operation>

    <operation>
        <search position="replace"><![CDATA[
        $sort = 'pd.name';
        ]]></search>
        <add><![CDATA[
        $sort = 'p.date_added';
        ]]></add>
    </operation>

    <operation>
        <search position="replace"><![CDATA[
        $order = 'ASC';
        ]]></search>
        <add><![CDATA[
        $order = 'DESC';
        ]]></add>
    </operation>

    <operation>
      <search position="before"><![CDATA[
          if (isset($this->request->post['height'])) {
      ]]></search>
      <add><![CDATA[
          // Seller
          if (isset($this->request->post['created_using'])) {
              $data['seller'] = $this->request->post['seller'];
          } elseif (!empty($product_info) && !empty($product_info['seller_id'])) {
              $data['seller'] = $this->model_soconfig_mproduct->getSellerName($product_info['seller_id']);
          } else {
              $data['seller'] = 'Me';
          }

          $data['is_seller'] = false;
          if($this->user->isSeller()) {
              $data['is_seller'] = true;
              // Fetch Categories if Seller
              $this->load->model('catalog/category');
              $data['categories'] = $this->model_catalog_category->getCategoriesForUserGroup($this->user->getGroupId());
          }

      ]]></add>
  </operation>

  <!-- Making Category Compulsory -->
  <operation>
      <search position="before"><![CDATA[
          if ((utf8_strlen($this->request->post['model']) < 1) || (utf8_strlen($this->request->post['model']) > 64)) {
      ]]></search>
      <add><![CDATA[
            if($this->user->isSeller()) {
              if(isset($this->request->post['product_category'])) {
                foreach($this->request->post['product_category'] as $category)
                {
                  if (trim($category) == "*") {
                    $this->error['product_category'] = $this->language->get('error_product_category');
                  }
                }
              }
            }else{

              if(!empty($this->request->post['product_category'])) {
                  foreach($this->request->post['product_category'] as $category_id)
                  {
                      if (empty($category_id)) {
                          $this->error['product_category'] = $this->language->get('error_product_category');
                      }
                  }
              }
           }

          if ((utf8_strlen($this->request->post['image']) < 1)) {
            $this->error['thumbnail_image'] = $this->language->get('error_thumbnail_image');
          }

          if ((utf8_strlen($this->request->post['location']) < 1) || (utf8_strlen($this->request->post['location']) > 64)) {
       			$this->error['location'] = $this->language->get('error_location');
       		}

      ]]></add>
  </operation>

  <operation>
      <search position="before"><![CDATA[
          if (isset($this->error['name'])) {
      ]]></search>
      <add><![CDATA[
      if (isset($this->error['product_category'])) {
          $data['error_product_category'] = $this->error['product_category'];
      } else {
          $data['error_product_category'] = '';
      }

      if (isset($this->error['price'])) {
          $data['error_price'] = $this->error['price'];
      } else {
          $data['error_price'] = '';
      }

      if (isset($this->error['thumbnail_image'])) {
          $data['error_thumbnail_image'] = $this->error['thumbnail_image'];
      } else {
          $data['error_thumbnail_image'] = '';
      }

      if (isset($this->error['location'])) {
          $data['error_location'] = $this->error['location'];
      } else {
          $data['error_location'] = '';
      }

      ]]></add>
  </operation>
  <!-- Making Category Compulsory ENDS-->

  <operation>
      <search position="before"><![CDATA[
          'filter_model' => $filter_model,
      ]]></search>
      <add><![CDATA[
          'filter_seller_id' => $seller_id,
      ]]></add>
  </operation>

  <operation>
      <search position="before"><![CDATA[
          if (isset($this->request->get['limit'])) {
      ]]></search>
      <add><![CDATA[
        $seller_id = 0;
        if($this->user->isSeller()) {
            $seller_id = $this->user->getId();
        }
      ]]></add>
  </operation>

  <operation>
      <search position="before"><![CDATA[
          $data['products'] = array();
      ]]></search>
      <add><![CDATA[
        $seller_id = 0;
        $is_seller = false;
        if($this->user->isSeller()) {
            $seller_id = $this->user->getId();
            $is_seller = true;
        }
      ]]></add>
  </operation>

  <operation>
      <search position="before"><![CDATA[
          'filter_model'	  => $filter_model,
      ]]></search>
      <add><![CDATA[
          'filter_seller_id' => $seller_id,
      ]]></add>
  </operation>

  <operation>
      <search position="before"><![CDATA[
          // Attributes
      ]]></search>
      <add><![CDATA[

          if (isset($this->request->post['brand'])) {
              $data['brand'] = $this->request->post['brand'];
          } elseif (!empty($product_info) && !empty($product_info['brand'])) {
              $data['brand'] = ($product_info['brand']);
          } else {
              $data['brand'] = '';
          }

          $data['all_product_filters'] =  $temp = array();
          $data['filters_str'] = '';
          $data['default_user_type'] = 0;
          $data['is_seller'] = false;
          if($this->user->isSeller()) {
            $data['is_seller'] = true;
            //$fg_raw = $this->model_catalog_filter->getFilterGroups();
            $fg_raw = $this->model_catalog_filter->getFilterGroupsByUg($this->user->getGroupId());

            foreach($fg_raw as $g) {
              $fg[] = array('name' => $g['name'],'fg_id' => $g['filter_group_id'], 'options' => $this->model_catalog_filter->getFiltersByGroupId($g['filter_group_id']));
            }

            $data['all_product_filters'] = $fg;

            // Get Default User Type Filter
            $ug = $this->user->getGroupId();

            $data['default_user_type'] = $this->model_catalog_filter->getTypeFilterByUg($ug);

            if(!empty($data['product_filters'])) {
              foreach($data['product_filters'] as $filter)
              {
                $temp[] = $filter['filter_id'];
              }
              $data['filters_str'] = implode(',',$temp);
            }
          }
      ]]></add>
  </operation>

  <operation>
      <search position="before"><![CDATA[
          $data['text_list'] = $this->language->get('text_list');
      ]]></search>
      <add><![CDATA[
          $data['entry_seller'] = $this->language->get('entry_seller');
          $data['is_seller'] = false;
          if($this->user->isSeller()) {
            $data['is_seller'] = true;
          }

          // Get Seller List
          $this->load->model('user/user');
          $data['sellers'] = $this->model_user_user->getSellers();
      ]]></add>
  </operation>

  <operation>
      <search position="after"><![CDATA[
          protected function getList() {
      ]]></search>
      <add><![CDATA[
          if (isset($this->request->get['filter_seller'])) {
              $filter_seller = $this->request->get['filter_seller'];
          } else {
              $filter_seller = null;
          }
          $data['filter_seller'] = $filter_seller;
      ]]></add>
  </operation>

  <operation>
      <search position="after"><![CDATA[
          $data['products'] = array();
      ]]></search>
      <add><![CDATA[
          $data['filter_seller'] = $filter_seller;
          if (isset($this->request->get['filter_status'])) {
      			$url .= '&filter_seller=' . $this->request->get['filter_seller'];
      		}
      ]]></add>
  </operation>

  <operation>
      <search position="after" index="1"><![CDATA[
          $filter_data = array(
      ]]></search>
      <add><![CDATA[
          'filter_seller'	  => $filter_seller,
      ]]></add>
  </operation>

  <operation>
      <search position="after"><![CDATA[
          'video1'   => $result['video1'],
      ]]></search>
      <add><![CDATA[
          'views'   => $result['viewed'],
          'supplier_url'   => $this->url->link('seller/seller/edit', 'token=' . $this->session->data['token'] . '&user_id=' . $result['seller_id'], 'SSL'),
          'supplier_name'   => $this->getSellerName($result['seller_id']),
      ]]></add>
  </operation>

  <operation>
      <search position="before"><![CDATA[
          public function add() {
      ]]></search>
      <add><![CDATA[
          protected function getSellerName($seller_id) {
            $seller_info = array();
            $this->load->model('seller/seller');
            $seller_info = $this->model_seller_seller->getSeller($seller_id);

            if(!empty($seller_info)) {
                return $seller_info['username'];
            }else{
                return "";
            }
          }
      ]]></add>
  </operation>

</file>

<file name="admin/model/catalog/filter.php">

  <operation>
      <search position="before"><![CDATA[
          public function getTotalFilterGroups() {
      ]]></search>
      <add><![CDATA[
        public function getFiltersByGroupId($filter_group_id) {
          $sql = "SELECT fd.name, fd.filter_id FROM " . DB_PREFIX . "filter_description AS fd WHERE fd.filter_group_id = '" . (int)$filter_group_id . "'";

          $query = $this->db->query($sql);

          return $query->rows;
        }

        public function getFilterGroupsByUg($user_group_id) {

          $sql = "SELECT fgug.filter_group_id, fgd.name FROM " . DB_PREFIX . "filter_group_user_group_mapper AS fgug LEFT OUTER JOIN filter_group_description fgd ON (fgd.filter_group_id = fgug.filter_group_id) WHERE fgug.user_group_id = '" . (int)$user_group_id . "' ";

          $query = $this->db->query($sql);

          return $query->rows;
        }


        public function getTypeFilterByUg($user_group_id) {

          $sql = "SELECT fd.filter_id FROM " . DB_PREFIX . "filter_description AS fd WHERE fd.name LIKE (SELECT ug.name FROM user_group as ug WHERE ug.user_group_id = '" . (int)$user_group_id . "') ";

          $query = $this->db->query($sql);

          return $query->row['filter_id'];
        }
      ]]></add>
  </operation>

</file>

<file name="admin/model/soconfig/mproduct.php">

  <operation>
      <search position="replace"><![CDATA[
          sku = '" . $this->db->escape($data['sku']) . "'
      ]]></search>
      <add><![CDATA[
          brand = '" . $this->db->escape($data['brand']) . "' ,sku = '" . $this->db->escape($data['sku']) . "' , tone_count = '" . $this->db->escape($data['tone_count']) . "' , silver_weight = '" . $this->db->escape($data['silver_weight']) . "' , gold_weight = '" . $this->db->escape($data['gold_weight']) . "' , diamond_weight = '" . $this->db->escape($data['diamond_weight']) . "' , parts_count = '" . $this->db->escape($data['parts_count']) . "' , created_using = '" . $this->db->escape($data['created_using']) . "'
      ]]></add>
  </operation>

  <operation>
      <search position="after"><![CDATA[
          'p.status',
      ]]></search>
      <add><![CDATA[
          'p.date_added',
      ]]></add>
  </operation>

  <operation>
      <search position="after"><![CDATA[
          $product_id = $this->db->getLastId();
      ]]></search>
      <add><![CDATA[
          if($this->user->isSeller())
          {
              $this->db->query("UPDATE " . DB_PREFIX . "product  SET seller_id = '".$this->user->getId()."' WHERE product_id = '{$product_id}' ");
          }
      ]]></add>
  </operation>

  <operation>
      <search position="after"><![CDATA[
          public function editProduct($product_id, $data) {
      ]]></search>
      <add><![CDATA[
          if($this->user->isSeller())
          {
              $this->db->query("UPDATE " . DB_PREFIX . "product  SET seller_id = '".$this->user->getId()."' WHERE product_id = '{$product_id}' ");
          }
      ]]></add>
  </operation>

  <operation>
      <search position="before"><![CDATA[
          public function getProduct($product_id) {
      ]]></search>
      <add><![CDATA[
          public function getSellerName($user_id) {

              $query = $this->db->query("SELECT u.username FROM `user` AS u WHERE u.user_id = '".(int)$user_id."' ");

              return $query->row['username'];
          }
      ]]></add>
  </operation>

  <operation>
      <search position="before"><![CDATA[
          if (!empty($data['filter_model'])) {
      ]]></search>
      <add><![CDATA[
        if (!empty($data['filter_seller_id'])) {
            $sql .= " AND p.seller_id = '" . (int)$data['filter_seller_id'] . "'";
        }

        if (isset($data['filter_seller']) && !empty($data['filter_seller'])) {
                $sql .= " AND p.seller_id = '" . (int)$data['filter_seller'] . "'";
        }
      ]]></add>
  </operation>

  <operation>
      <search position="replace"><![CDATA[
          $this->db->query("INSERT INTO " . DB_PREFIX . "product_image SET product_id = '" . (int)$product_id . "', image = '" . $this->db->escape($product_image['image']) . "', sort_order = '" . (int)$product_image['sort_order'] . "'");
      ]]></search>
      <add><![CDATA[
        if($this->user->isSeller()){
            $this->db->query("INSERT INTO " . DB_PREFIX . "product_image SET product_id = '" . (int)$product_id . "', image = '" . $this->db->escape($product_image['image']) . "', sort_order = '" . (int)$product_image['sort_order'] . "', seller_id = '".$this->user->getId()."' ");
        }else{
            $this->db->query("INSERT INTO " . DB_PREFIX . "product_image SET product_id = '" . (int)$product_id . "', image = '" . $this->db->escape($product_image['image']) . "', sort_order = '" . (int)$product_image['sort_order'] . "'");
        }
      ]]></add>
  </operation>

</file>

<file name="admin/model/catalog/category.php">

  <operation>
      <search position="before"><![CDATA[
          public function getTotalCategories() {
      ]]></search>
      <add><![CDATA[
          public function getCategoriesForUserGroup($user_group_id) {

            $sql = "SELECT cp.category_id AS category_id, GROUP_CONCAT(cd1.name ORDER BY cp.level SEPARATOR '&nbsp;&nbsp;&gt;&nbsp;&nbsp;') AS name, c1.parent_id, c1.sort_order
                    FROM " . DB_PREFIX . "category_path cp
                    LEFT JOIN " . DB_PREFIX . "category c1
                    ON (cp.category_id = c1.category_id)
                    LEFT JOIN " . DB_PREFIX . "category c2
                    ON (cp.path_id = c2.category_id)
                    LEFT JOIN " . DB_PREFIX . "category_description cd1
                    ON (cp.path_id = cd1.category_id)
                    LEFT JOIN " . DB_PREFIX . "category_description cd2
                    ON (cp.category_id = cd2.category_id)
                    LEFT JOIN " . DB_PREFIX . "category_to_user_group ctug
                    ON (ctug.category_id = cp.category_id)
                    WHERE cd1.language_id = '" . (int)$this->config->get('config_language_id') . "'
                    AND ctug.user_group_id = '" . (int)$user_group_id . "'
                    AND cd2.language_id = '" . (int)$this->config->get('config_language_id') . "'";

            $sql .= " GROUP BY cp.category_id";

            $query = $this->db->query($sql);

            return $query->rows;
          }
      ]]></add>
  </operation>

</file>

<file name="admin/view/template/catalog/product_list.tpl">

  <operation>
      <search position="replace"><![CDATA[
          <button type="submit" form="form-product" formaction="<?php echo $copy; ?>" data-toggle="tooltip" title="<?php echo $button_copy; ?>" class="btn btn-default"><i class="fa fa-copy"></i></button>
      ]]></search>
      <add><![CDATA[

      ]]></add>
  </operation>

</file>

<file name="admin/view/template/extension/soconfig/mproduct_list.tpl">

  <operation>
      <search position="replace"><![CDATA[
          <button type="submit" form="form-mproduct" formaction="<?php echo $copy; ?>" data-toggle="tooltip" title="<?php echo $button_copy; ?>" class="btn btn-default"><i class="fa fa-copy"></i></button>
      ]]></search>
      <add><![CDATA[
        <?php if(!$is_seller) { ?>
          <button type="submit" form="form-mproduct" formaction="<?php echo $copy; ?>" data-toggle="tooltip" title="<?php echo $button_copy; ?>" class="btn btn-default"><i class="fa fa-copy"></i></button>
        <?php } ?>
      ]]></add>
  </operation>

  <operation>
      <search position="replace"><![CDATA[
          <button type="button" data-toggle="tooltip" title="<?php echo $button_delete; ?>" class="btn btn-danger" onclick="confirm('<?php echo $text_confirm; ?>') ? $('#form-mproduct').submit() : false;"><i class="fa fa-trash-o"></i></button>
      ]]></search>
      <add><![CDATA[
          <?php if(!$is_seller) { ?>
            <button type="button" data-toggle="tooltip" title="<?php echo $button_delete; ?>" class="btn btn-danger" onclick="confirm('<?php echo $text_confirm; ?>') ? $('#form-mproduct').submit() : false;"><i class="fa fa-trash-o"></i></button>
          <?php } ?>
      ]]></add>
  </operation>

  <operation>
      <search position="replace"><![CDATA[
          <td class="text-left"><?php echo $product['name']  ; ?>  <?php if( !empty($product['video1']) || !empty($product['tab_title']) ) echo $featured = '<span class="label label-info">Featured</span>'; ?></td>
      ]]></search>
      <add><![CDATA[
          <td class="text-left"><?php echo $product['name']  ; ?>  <?php if( !empty($product['video1']) || !empty($product['tab_title']) ) echo $featured = '<span class="label label-info">Featured</span>'; ?> <br/> <h6>- Views: <?php echo number_format($product['views']); ?> </h6> <?php if(!$is_seller && !empty($product['supplier_name'])) { ?><h6>- Supplier: <a href="<?php echo $product['supplier_url']; ?>"> <?php echo $product['supplier_name']; ?> </a> </h6><?php } ?> </td>
      ]]></add>
  </operation>

</file>

<!-- Search List Edits -->

<file name="catalog/view/theme/so-topdeal/template/extension/module/so_searchpro/default.tpl">

  <operation>
      <search position="replace" offset="2"><![CDATA[
          if (json[i]['tax']) {
      ]]></search>
      <add><![CDATA[
        if (json[i]['tax']) {
          html += '<span class="price-tax hidden"><?php echo $text_tax;?> : ' + json[i]['tax'] + '</span>';
        }
        if (json[i]['seller_type'] && json[i]['seller_type'] !== "") {
          html += '<span class="price-tax"> ' + json[i]['seller_type'] + '</span>';
        }
      ]]></add>
  </operation>

</file>

<file name="catalog/controller/extension/module/so_searchpro.php">

  <operation>
      <search position="before"><![CDATA[
          $json[] = array(
      ]]></search>
      <add><![CDATA[
        // Check for Seller Type
				$seller_type = "";
				$sql_seller_type = "SELECT ug.name FROM product AS p INNER JOIN `user` u ON (p.seller_id = u.user_id) INNER JOIN user_group ug ON (ug.user_group_id = u.user_group_id) WHERE p.product_id = '{$result['product_id']}'";
				$query = $this->db->query($sql_seller_type);
				foreach ($query->rows as $row) {
					 $seller_type = $row['name'];
				}
      ]]></add>
  </operation>

  <operation>
      <search position="after"><![CDATA[
          'price'      => $price,
      ]]></search>
      <add><![CDATA[
        'seller_type' => $seller_type,
      ]]></add>
  </operation>

</file>

<!-- Search List Edits -- ENDS -->

</modification>
